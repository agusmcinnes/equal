<div class="profile-container">
  <div class="profile-content">
    <!-- Header -->
    <div class="profile-header">
      <h1>Mi Perfil</h1>
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading-state">
      <div class="spinner"></div>
      <p>Cargando perfil...</p>
    </div>

    <!-- Error State -->
    <div *ngIf="!isLoading && errorMessage && !userProfile" class="error-state">
      <span class="material-icons">error_outline</span>
      <p>{{ errorMessage }}</p>
      <button class="btn btn-primary" (click)="ngOnInit()">
        Reintentar
      </button>
    </div>

    <!-- No Profile State - Allow Creation -->
    <div *ngIf="!isLoading && !errorMessage && !userProfile && currentUser" class="profile-main">
      <div class="no-profile-state">
        <span class="material-icons">account_circle</span>
        <h2>Completa tu Perfil</h2>
        <p>Aún no has creado tu perfil. ¡Crea uno ahora!</p>
        <button class="btn btn-primary" (click)="createEmptyProfile()">
          <span class="material-icons">add</span>
          Crear Perfil
        </button>
      </div>
    </div>

    <!-- Profile Content -->
    <div *ngIf="!isLoading && userProfile && currentUser" class="profile-main">
      <!-- Avatar Section -->
      <div class="avatar-section">
        <div class="avatar-container">
          <img 
            *ngIf="userProfile.avatar_url" 
            [src]="userProfile.avatar_url" 
            alt="Avatar"
            class="avatar-image"
          />
          <div 
            *ngIf="!userProfile.avatar_url" 
            class="avatar-placeholder"
          >
            <span class="material-icons">account_circle</span>
          </div>
          <button 
            class="avatar-upload-btn"
            (click)="triggerAvatarUpload()"
            [disabled]="isSaving"
            title="Cambiar foto de perfil"
          >
            <span class="material-icons">camera_alt</span>
          </button>
          <input 
            #avatarInput
            id="avatarInput"
            type="file" 
            accept="image/*"
            (change)="onAvatarSelected($event)"
            class="hidden-input"
          />
        </div>
      </div>

      <!-- User Info Section -->
      <div class="user-info-section">
        <!-- Edit/Save Buttons -->
        <div class="action-buttons">
          <button 
            *ngIf="!isEditing"
            class="btn btn-primary"
            (click)="startEditing()"
          >
            <span class="material-icons">edit</span>
            Editar Perfil
          </button>
          <div *ngIf="isEditing" class="edit-actions">
            <button 
              class="btn btn-success"
              (click)="saveProfile()"
              [disabled]="isSaving"
            >
              <span class="material-icons">save</span>
              Guardar
            </button>
            <button 
              class="btn btn-cancel"
              (click)="cancelEditing()"
              [disabled]="isSaving"
            >
              <span class="material-icons">close</span>
              Cancelar
            </button>
          </div>
        </div>

        <!-- Messages -->
        <div *ngIf="successMessage" class="success-message">
          <span class="material-icons">check_circle</span>
          {{ successMessage }}
        </div>
        <div *ngIf="errorMessage" class="error-message">
          <span class="material-icons">error</span>
          {{ errorMessage }}
        </div>

        <!-- Editable Fields -->
        <div class="info-field">
          <label>Nombre Completo</label>
          <input 
            *ngIf="isEditing"
            type="text"
            class="edit-input"
            [(ngModel)]="editForm.full_name"
            placeholder="Ingresa tu nombre"
          />
          <p *ngIf="!isEditing" class="info-value">
            {{ userProfile.full_name || 'No especificado' }}
          </p>
        </div>

        <div class="info-field">
          <label>Email</label>
          <p class="info-value">{{ currentUser.email }}</p>
        </div>

        <div class="info-field">
          <label>Biografía</label>
          <textarea 
            *ngIf="isEditing"
            class="edit-input edit-textarea"
            [(ngModel)]="editForm.bio"
            placeholder="Cuéntanos sobre ti"
            rows="3"
          ></textarea>
          <p *ngIf="!isEditing" class="info-value">
            {{ userProfile.bio || 'No especificada' }}
          </p>
        </div>

        <div class="info-field">
          <label>Miembro desde</label>
          <p class="info-value">
            {{ formatDate(userProfile.created_at) }}
          </p>
        </div>
      </div>
    </div>

    <!-- Motto Section -->
    <div class="motto-section">
      <div class="motto-card">
        <span class="material-icons motto-icon">lightbulb</span>
        <h2>Nuestro Lema</h2>
        <p class="motto-text">
          "La economía personal comienza con la conciencia de tus gastos.<br/>
          Cada peso cuenta, cada decisión suma.<br/>
          Toma el control de tu dinero hoy, y construye el futuro que deseas mañana."
        </p>
      </div>
    </div>
  </div>
</div>
